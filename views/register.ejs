<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="/images/tetris.ico" rel="shortcut icon" />
  <link rel="stylesheet" href="/css/tetris.css" type="text/css">
  <link rel="stylesheet" href="/css/form.css" type="text/css">
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <title>Register</title>
</head>

<body id="register-body">
  <form id="register">
    <p class="registro">Register</p>
    <input class="text" type="text" name="username" placeholder="Username" size="30" required />
    <input class="text" type="text" name="name" placeholder="Name" size="30" required />
    <input class="text" type="text" name="surname" placeholder="Surname" size="40" required />
    <input class="text" type="number" name="age" placeholder="Age" min="1" max="150" required />
    <select id="institution" class="text" name="institution" required>
      <option disabled selected hidden>Select Institution</option>
      <% if(institution_list.length){ for(let i=0; i < institution_list.length; i++) { %>
        <% if(institution_list[i].name !=="admin" ) {%>
          <option value="<%= institution_list[i].id %>">
            <%=institution_list[i].name %>
          </option>
          <% } }%>
            <% } %>
    </select>
    <select class="text" name="study_group_id">
      <option disabled selected hidden>Select Group</option>
    </select>
    <input class="text" type="password" name="pass" placeholder="Password" size="40" required />
    <input class="text" type="password" name="pass2" placeholder="Repeat the password" size="40" required />
    <input id="submit-button" class="button" type="submit" value="SUBMIT" />
    <a id="href-button" class="button" href="/">BACK</a>
  </form>
</body>

<script>
  $(document).ready(function () {
    $('#register').submit(function (event) {
      // Evitar env√≠o convencional del formulario
      event.preventDefault();
      // Obtener los datos del formulario
      const formData = $(this).serialize();
      // Realizar la solicitud Ajax
      $.ajax({
        type: 'POST',
        url: '/new',
        data: { data: formData },
        success: function (response) {
          // Manejar la respuesta del servidor
          alert(response);
          window.location.href = '/';
        },
        error: function (xhr, status, error) {
          // Manejar errores de la solicitud
          alert(xhr.responseText);
        }
      });
    });

    $('#institution').change(function () {
      // Obtener los datos del formulario
      const institution_id = $(this).serialize();
      // Realizar la solicitud Ajax
      $.ajax({
        type: 'POST',
        url: '/study_group',
        data: { data: institution_id },
        success: function (response) {
          // Manejar la respuesta del servidor
          const study_group = response;
          // Generar el formulario HTML utilizando el valor study_group
          let options = '';
          if (study_group.length) {
            for (let i = 0; i < study_group.length; i++) {
              options += `
          <option value="${study_group[i].id}">
            ${study_group[i].name}
          </option>`;
            }
          }
          // Agregar las opciones al elemento select del formulario
          const selectElement = document.querySelector('select[name="study_group_id"]');
          selectElement.innerHTML = options;
        },
        error: function (xhr, status, error) {
          // Manejar errores de la solicitud
          alert(xhr.responseText);
        }
      });
    });
  });
</script>

</html>